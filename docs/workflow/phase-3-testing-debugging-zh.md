# 阶段3：测试、调试和代码审查 🧪🔍

**工具**：DevTools MCP + 您的编码代理 + 手动测试 + 代码审查

## 概述

此阶段将测试、调试和代码审查结合到一个综合质量保证过程中。目标是确保您的代码在部署之前正确工作、性能良好并符合质量标准。

**基本资源：**
- **[故障排除指南](../troubleshooting/README-zh.md)** - 紧急流程图、症状查找表和恢复模式
- **[掌握AI提示：调试](../prompting/task-specific-patterns-zh.md#调试提示)** - 使用AI进行调试的有效提示
- **[质量标准](../quality-standards/README-zh.md)** - 可访问性、SEO和性能要求

---

## 🚀 第1部分：自动化测试和调试

### Awesome Vibecoding优势：免提调试

**传统调试与AI驱动的测试：**

**旧方式：**
- 手动测试损坏的功能
- 花费数小时调查控制台错误
- 手动检查网络请求和响应
- 在重复测试上浪费宝贵时间

**使用Chrome DevTools MCP的新方式：**
- **任务AI代理**自动处理所有调试
- **节省您最宝贵的资源** - 时间
- **专注于业务增长**，而AI修复技术问题

### 自动化测试过程

**步骤1：通过MCP进行自动化测试**
```
"使用DevTools MCP测试登录页面并查找错误。"
```

代理将：
- 打开浏览器
- 导航应用程序
- 收集控制台错误
- 分析网络调用
- 识别问题
- 提出修复

**步骤2：手动测试**
- 自己遍历功能
- 记录边缘情况
- 检查不同的浏览器/设备

### 如何使用自动化Web调试

**示例场景：损坏的联系表单**

1. **启动您的本地开发服务器：**
   ```bash
   npm run dev
   # 或 python -m http.server等
   ```

2. **使用特定指令任务AI代理：**
   ```
   "我的联系表单提交按钮损坏了。请：
   - 导航到http://localhost:3000
   - 用测试数据填写联系表单
   - 单击提交按钮
   - 使用Chrome DevTools调试任何问题
   - 检查控制台错误、网络请求和响应
   - 识别并修复根本原因
   - 验证修复有效"
   ```

3. **AI代理将做什么：**
   - **导航**到您的本地主机URL
   - **拍摄**页面结构的快照
   - **交互**表单元素
   - **实时监控**网络请求
   - **分析**控制台错误和警告
   - **检查**API响应和状态代码
   - **调试**JavaScript执行流程
   - **识别**问题的根本原因
   - **建议**并实施修复

### 常见调试场景

**损坏的用户交互：**
- 单击处理程序不工作
- 表单验证问题
- API调用失败
- 状态管理问题
- 响应式设计错误

**性能问题：**
- 加载时间慢
- 内存泄漏
- 低效的JavaScript
- 大包大小
- 慢API响应

### 自动化调试的好处

**⏰ 节省时间：**
- 不再有手动测试周期
- 无需自己重现错误
- AI可以快速测试多个场景
- 专注于功能，而不是调试

**🎯 准确性：**
- AI捕获人类可能错过的边缘情况
- 系统的测试方法
- 全面的错误分析
- 详细调查所有故障点

**🚀 生产力提升：**
- 在处理其他任务时调试
- 并行开发和测试
- 更快的迭代周期
- 每周交付更多功能

**💼 商业价值：**
- 更快地发布功能
- 提高代码质量
- 减少错误报告
- 更好的用户体验

### 最大效率的专业提示

1. **在您的指令中要具体：**
   ```
   不要说："修复联系表单"
   要说："导航到/contact，填写所有字段，单击提交，检查控制台错误，验证API响应，修复任何问题"
   ```

2. **尽可能提供上下文：**
   ```
   "联系表单使用Cloudflare Workers API端点/api/contact。它期望JSON负载并返回{success: true}。表单在提交时显示加载状态。"
   ```

3. **让代理独立工作：**
   - 启动调试任务
   - 在AI工作时处理其他事情（客户沟通、营销等）
   - 回来查看详细分析和建议的修复

### 真实世界示例工作流程

**您**："我需要启动我的SaaS产品，但支付集成损坏了"

**AI代理**：*(30分钟后)*
```
✅ 调试完成 - 支付集成已修复

**发现的问题：**
1. Stripe API端点已过时（v3 → v4）
2. 支付处理端点上缺少CORS头
3. 错误处理没有正确捕获网络故障

**应用的修复：**
- 更新API调用到Stripe v4
- 添加适当的CORS中间件
- 实施全面的错误处理
- 为失败的请求添加重试逻辑

**测试结果：**
- ✅ 测试支付：10/10成功
- ✅ 错误处理：覆盖所有边缘情况
- ✅ 移动响应性：完美工作
- ✅ 性能：<2秒加载时间
```

**结果**：您在LinkedIn外联上花费了30分钟，而AI修复了您的支付系统。

---

## 🎯 第2部分：Chrome DevTools精通

### Chrome DevTools基础

**基本资源：**
[Chrome DevTools官方文档](https://developer.chrome.com/docs/devtools)

**为什么学习DevTools：**
- AI可以自动化测试，但您需要了解发生了什么
- 最终QA仍然需要手动测试
- 对于理解AI报告的问题至关重要
- 专业开发人员了解他们的浏览器工具

### 必要的DevTools知识

#### 控制台标签基础

**它做什么：**
- 显示JavaScript错误和警告
- 记录自定义消息（`console.log()`）
- 允许交互式JavaScript执行
- 显示网络错误

**关键操作：**
```javascript
// 过滤
// 点击"错误"、"警告"、"信息"进行过滤

// 清除控制台
Cmd/Ctrl + K 或 清除控制台按钮

// 在控制台内搜索
Cmd/Ctrl + F

// 导航时保留日志
☑ 保留日志
```

**要查找的常见问题：**
```
❌ Uncaught TypeError: Cannot read property 'X' of undefined
   → 某些东西在不应为null/undefined时为null/undefined

❌ 404 (Not Found) - Failed to load resource
   → 文件路径不正确或文件丢失

❌ CORS policy: No 'Access-Control-Allow-Origin' header
   → 后端未配置跨源请求

⚠️  Deprecated API warning
   → 使用过时的方法（现在不会中断，但是未来问题）
```

**专业提示：**
- 当某些东西损坏时，始终首先检查控制台
- `console.log()`是开发期间的朋友
- `console.table()`用于很好地显示数组/对象
- `console.error()`用于突出重要错误

#### 网络标签基础

**它做什么：**
- 显示所有HTTP请求
- 显示请求/响应详细信息
- 监控加载时间
- 调试API故障

**关键列：**
```
名称       - 请求URL
状态     - HTTP状态代码（200、404、500等）
类型       - 资源类型（文档、脚本、xhr等）
发起者  - 触发请求的内容
大小       - 响应大小
时间       - 花了多长时间
瀑布图  - 可视化时间线
```

**常见问题：**
```
❌ 状态404 - 未找到
   → 检查URL拼写和文件位置

❌ 状态500 - 内部服务器错误
   → 后端问题，检查服务器日志

❌ 状态401/403 - 未授权/禁止
   → 身份验证或权限问题

⏱️  请求花费> 3秒
   → 性能问题，优化或缓存

🔴 失败（红色）请求
   → 网络错误、CORS或阻止的请求
```

**检查API调用：**
```
1. 通过"XHR"或"Fetch"过滤API调用
2. 单击请求以查看：
   - 头（请求/响应）
   - 预览（响应体）
   - 响应（原始响应）
   - 时间（请求时间的细分）
```

**专业提示：**
- 右键单击请求 → "复制为cURL"以在终端中重现
- "保留日志"以在页面导航中保留请求
- 限制网络（Fast 3G、Slow 3G）以测试慢速连接
- 测试更改时"禁用缓存"

#### 元素/检查器基础

**它做什么：**
- 检查HTML结构
- 实时修改CSS
- 测试响应式布局
- 调试视觉问题

**关键操作：**
```
检查元素：右键单击元素 → 检查
或：Cmd/Ctrl + Shift + C（检查器模式）

修改HTML：在树中双击元素
修改CSS：在样式面板中添加/编辑样式
测试状态：样式面板中的:hover :active :focus
```

**响应式设计模式：**
```
1. 单击设备图标（或Cmd/Ctrl + Shift + M）
2. 选择设备：
   - iPhone 12/13 Pro
   - iPad Pro
   - 自定义尺寸
3. 测试：
   - 纵向和横向
   - 不同设备尺寸
   - 设备像素比
```

**常见问题：**
```
❌ 元素不可见但存在于DOM中
   → CSS：display: none、opacity: 0或定位在屏幕外

❌ 布局在特定宽度处中断
   → 缺少媒体查询或硬编码宽度

❌ 样式未应用
   → 特异性问题（检查计算选项卡以查看覆盖）
   → 错误的选择器
```

**专业提示：**
- 使用"计算"选项卡查看最终应用的样式
- 检查"事件监听器"以查看附加的JavaScript事件
- "可访问性"选项卡显示ARIA标签和角色
- 使用样式面板中的颜色选择器进行快速颜色调整

#### 性能标签基础

**何时使用：**
- 网站感觉慢
- 调查加载时间
- 优化动画
- 查找性能瓶颈

**如何分析：**
```
1. 打开性能标签
2. 单击记录（●）
3. 执行慢速操作
4. 单击停止
5. 分析记录
```

**要查找的内容：**
```
🔴 大红条 - 阻塞主线程的长任务
🟡 黄色部分 - JavaScript执行
🟣 紫色部分 - 渲染/布局
🟢 绿色部分 - 绘制

查找：
- 长任务（> 50ms）
- 过多的重排
- JavaScript花费太长时间
- 太多的函数调用
```

**快速获胜：**
```
❌ 每次滚动都运行JavaScript
   → 防抖或节流滚动处理程序

❌ 大图像加载缓慢
   → 压缩和延迟加载

❌ 太多的DOM操作
   → 批量更新或使用虚拟DOM（React）
```

---

## 📱 第3部分：移动优先测试策略

### 关键现实

**对于大多数小型商业网站，85%+的流量是移动的。**

**最常见的错误：**
在笔记本电脑上测试（您开发的地方），而不是首先优化移动设备。

**为什么这很重要：**
- 用户体验 = 移动体验
- Google使用移动优先索引进行SEO
- 慢速移动网站 = 失去客户
- 大多数错误出现在移动设备上，而不是桌面上

### 移动优先方法

**工作流程：**
```
1. 移动测试首先（始终）
2. 平板测试其次
3. 桌面测试最后
```

**不是：**
```
❌ 桌面优先，移动"如果我有时间"
❌ 仅桌面，假设移动"工作"
❌ 移动测试作为事后考虑
```

### 移动测试工作流程

#### 步骤1：Chrome DevTools移动模拟

**打开设备模式：**
```
Cmd/Ctrl + Shift + M
或
单击DevTools工具栏中的设备图标
```

**测试这些设备：**
```
优先级1（最常见）：
- iPhone 13/14 Pro (390 x 844)
- iPhone 13/14 Pro Max (428 x 926)
- Samsung Galaxy S21/S22 (360 x 800)

优先级2（常见）：
- iPhone SE (375 x 667) - 小屏幕
- iPad (768 x 1024) - 平板
- iPad Pro (1024 x 1366) - 大平板
```

**测试两个方向：**
- 纵向（默认，90%的使用）
- 横向（特别是对于表单和内容）

#### 步骤2：触摸交互测试

**常见触摸问题：**
```
❌ 按钮太小（< 44x44像素）
   → 手指无法准确点击

❌ 链接靠得太近
   → 在错误的链接上意外点击

❌ 在触摸上不工作的悬停效果
   → 移动上没有悬停，使用:active或:focus

❌ 需要悬停的下拉菜单
   → 转换为点击/点击菜单
```

**使用触摸模拟测试：**
```
DevTools → 设置 → 设备 → 添加自定义设备
为自定义设备启用"触摸"
```

**触摸友好设计：**
```css
/* 最小触摸目标大小 */
button, a {
  min-width: 44px;
  min-height: 44px;
  padding: 12px;
}

/* 可点击元素之间的适当间距 */
.button-group button {
  margin: 8px;
}

/* 删除仅悬停的交互 */
.dropdown:hover .menu {
  display: block;  /* ❌ 在移动上不工作 */
}

/* 使用点击/点击代替 */
.dropdown.active .menu {
  display: block;  /* ✅ 在移动上工作 */
}
```

#### 步骤3：真实设备测试

**DevTools模拟 ≠ 真实设备**

**DevTools测试后，在真实设备上测试：**
- 您的手机（至少）
- 平板（如果可能）
- 客户的设备（理想）

**如何在真实设备上测试：**

**选项1：本地网络访问**
```bash
# 查找您的本地IP
# macOS/Linux: ifconfig | grep "inet "
# Windows: ipconfig

# 启动开发服务器
npm run dev
# 通常：http://localhost:3000

# 在手机上访问
http://192.168.1.X:3000
（替换为您的IP）
```

**选项2：Cloudflare隧道（预览）**
```bash
# 将分支部署到Cloudflare Pages
git push origin feat/your-feature

# 从手机访问预览URL
https://feat-your-feature.project.pages.dev
```

**选项3：Chrome远程调试**
```
1. 在Android手机上启用USB调试
2. 通过USB连接手机
3. Chrome DevTools → 更多工具 → 远程设备
4. 直接在手机上检查和调试
```

#### 步骤4：移动特定测试检查清单

**视觉布局：**
- [ ] 所有文本无需缩放即可阅读
- [ ] 图像正确缩放
- [ ] 无水平滚动（除非有意）
- [ ] 导航可访问和可用
- [ ] 表单适合屏幕
- [ ] 按钮足够大以点击
- [ ] 交互元素之间的间距足够

**性能：**
- [ ] 页面在3G上< 3秒加载
- [ ] 加载期间无布局偏移（CLS）
- [ ] 平滑滚动
- [ ] 快速点击响应
- [ ] 高效的图像加载

**功能：**
- [ ] 表单可提交
- [ ] 链接可点击
- [ ] 下拉菜单可访问
- [ ] 模态框/弹出窗口可用
- [ ] 控制台中无JavaScript错误
- [ ] API调用工作

**用户体验：**
- [ ] 文本足够大（最小16px）
- [ ] 对比度足够（4.5:1比例）
- [ ] 表单使用适当的输入类型（email、tel、number）
- [ ] 键盘显示适当的布局（电话的数字）
- [ ] 表单上的自动完成工作
- [ ] 返回按钮按预期工作

### 常见移动问题和修复

#### 问题1：文本太小

**问题：**
```css
body {
  font-size: 14px;  /* ❌ 在移动上太小 */
}
```

**修复：**
```css
body {
  font-size: 16px;  /* ✅ 可读最小值 */
}

@media (min-width: 768px) {
  body {
    font-size: 18px;  /* 桌面上更大 */
  }
}
```

#### 问题2：水平滚动

**问题：**
```css
.container {
  width: 1200px;  /* ❌ 固定宽度在移动上溢出 */
}
```

**修复：**
```css
.container {
  width: 100%;  /* ✅ 流体宽度 */
  max-width: 1200px;  /* 桌面上的最大宽度 */
  padding: 0 16px;  /* 为边缘添加填充 */
}
```

#### 问题3：按钮太小

**问题：**
```html
<a href="/contact">联系</a>
<!-- 文本链接难以点击 -->
```

**修复：**
```html
<a href="/contact" class="button">联系</a>

<style>
.button {
  display: inline-block;
  padding: 12px 24px;
  min-width: 44px;
  min-height: 44px;
  text-align: center;
}
</style>
```

#### 问题4：表单难以填写

**问题：**
```html
<input type="text" name="email">
<!-- 无自动完成，错误的键盘 -->
```

**修复：**
```html
<input
  type="email"
  name="email"
  autocomplete="email"
  placeholder="your@email.com"
>
<!-- 正确的键盘，启用自动完成 -->
```

### 移动上的性能测试

**Chrome DevTools网络限制：**
```
网络标签 → 限制下拉菜单：
- Slow 3G（测试最坏情况）
- Fast 3G（平均移动）
- 无限制（Wi-Fi）
```

**Lighthouse移动审计：**
```
1. 在DevTools中打开Lighthouse标签
2. 选择"移动"设备
3. 单击"分析页面加载"
4. 审查分数：
   - 性能（目标：90+）
   - 可访问性（目标：90+）
   - 最佳实践（目标：90+）
   - SEO（目标：100）
```

**目标指标（移动）：**
```
✅ 首次内容绘制：< 1.8秒
✅ 最大内容绘制：< 2.5秒
✅ 可交互时间：< 3.8秒
✅ 累积布局偏移：< 0.1
✅ 总页面大小：< 1MB
```

---

## 💼 第4部分：客户特定测试

### 了解您的客户受众

**向客户询问的关键问题：**
"您的典型客户是谁，他们如何访问您的网站？"

**为什么这很重要：**
- B2B与B2C有不同的使用模式
- 行业影响设备使用
- 受众影响测试优先级

### B2B（企业对企业）客户

**典型场景：**
- 工作时间内的办公室工作人员
- 桌面/笔记本电脑主要设备
- 专业环境
- 企业网络

**示例：**
- 会计公司
- 法律服务
- B2B SaaS公司
- 制造供应商
- 企业咨询

**测试优先级：**
```
1. 桌面（60-80%的流量）
2. 移动（20-40%的流量）
3. 平板（5-10%的流量）
```

**桌面特定考虑：**
- 较大的表单是可以接受的
- 更复杂的导航是可以的
- 悬停交互工作
- 详细的数据表可用
- 布局中的多列

**客户沟通：**
```
"基于您的B2B受众，我优先考虑桌面测试，
因为您的大多数客户将从办公室计算机访问网站。
移动也会完美工作，但体验针对桌面用户进行了优化。"
```

### B2C（企业对消费者）客户

**典型场景：**
- 消费者随时浏览
- 移动主要设备（特别是本地企业）
- 即时搜索
- 快速决策

**示例：**
- 餐厅
- 水管工、电工、暖通空调
- 理发店、理发店
- 零售店
- 本地服务

**测试优先级：**
```
1. 移动（70-90%的流量）
2. 桌面（10-25%的流量）
3. 平板（5-10%的流量）
```

**移动特定考虑：**
- 点击通话突出
- 简单导航
- 快速加载
- 最小表单字段
- 大、可点击的按钮
- Google Maps集成
- 易于查找的营业时间和位置

**客户沟通：**
```
"由于您是本地服务企业，我主要针对移动用户进行优化。
大多数人在手机上搜索时会找到您，因此移动性能和可用性至关重要。"
```

### 行业特定模式

#### 餐厅和食品服务
```
移动：85-90%
高峰时间：午餐（上午11点-下午2点），晚餐（下午5点-晚上8点）
优先级：菜单、电话、方向、营业时间
```

#### 专业服务（律师、会计师）
```
移动：50-60%
桌面：40-50%
优先级：资质、服务、联系表单
```

#### 家庭服务（水管工、电工）
```
移动：80-90%
通常是紧急情况
优先级：电话号码、服务区域、可用性
```

#### 电子商务
```
移动：60-70%（并且增长）
桌面：30-40%
优先级：产品图像、结账流程、移动支付
```

#### 医疗保健
```
移动：65-75%
桌面：25-35%
优先级：预约、方向、保险、表单
```

### 客户发现问题

**在初步咨询期间询问：**

**问题1：受众人口统计**
```
"您的典型客户是谁？"
- 年龄范围
- 技术熟练度
- 他们何时搜索服务
```

**问题2：当前流量数据**
```
"您当前网站有Google Analytics吗？"
- 检查移动与桌面分割
- 审查实际数据与假设
```

**问题3：客户旅程**
```
"客户通常如何找到您？"
- Google搜索（通常移动）
- 推荐（混合设备）
- 直接URL（通常桌面）
- 社交媒体（通常移动）
```

**问题4：主要操作**
```
"您希望访问者在您的网站上做什么？"
- 给您打电话（移动友好的CTA至关重要）
- 填写表单（如果复杂则桌面友好）
- 浏览产品（移动和桌面相等）
- 预约（在两者上都有效，但测试移动）
```

### 调整测试策略

**对于桌面为主的客户：**
```
测试顺序：
1. 桌面功能 ✓
2. 桌面设计 ✓
3. 移动响应式 ✓
4. 移动功能 ✓

可以针对桌面进行优化，同时确保移动工作。
```

**对于移动为主的客户：**
```
测试顺序：
1. 移动功能 ✓
2. 移动性能 ✓
3. 移动设计 ✓
4. 桌面（应该只是工作）✓

针对移动进行优化；桌面获得更简单、更宽的布局。
```

**有疑问时：移动优先**
默认假设：**85%移动流量**，直到客户数据另有说明。

---

## 🔍 第5部分：代码审查和重构

### 调试深入

**黄金规则**：只有深入挖掘时，调试才有效。

**不要：**
- "不工作，修复它"
- "仍然不工作，请修复"（x100）

**要：**
- 分析错误（手动或通过MCP）
- 收集特定于问题的日志
- 识别确切的根本原因
- 告诉AI您发现的内容+要求修复

**如果相同的错误重复2-3次：**
1. 停止——某些东西根本上是错误的
2. 使用MCP收集精确的日志
3. 在下一个提示之前分析它们
4. 您可能需要改变方法，而不仅仅是代码

### 代码审查过程

**步骤1：第一遍 - AI审查**
- Claude或GPT对整个功能代码库的审查
- 代码质量和架构的全面分析

**步骤2：识别问题**
- 性能问题
- 安全漏洞
- 代码重复
- 约定违规
- 可维护性问题
- 文档缺口

**步骤3：重构实施**
- AI实施建议的改进
- 应用最佳实践和设计模式
- 优化性能瓶颈
- 增强安全措施

**步骤4：第二次审查**
- 确保重构后一切仍然工作
- 验证改进不会破坏现有功能
- 优化后的性能测试

### 代码质量检查清单

**✅ 性能：**
- 高效的算法和数据结构
- 最少的不必要计算
- 优化的数据库查询
- 适当的缓存策略

**✅ 安全：**
- 输入验证和清理
- 适当的身份验证和授权
- SQL注入预防
- XSS保护
- CSRF保护

**✅ 可维护性：**
- 清晰和描述性的命名约定
- 适当的代码组织和结构
- 一致的编码风格
- 充足的注释和文档
- 单一责任原则

**✅ 最佳实践：**
- 错误处理和日志记录
- 适当的async/await使用
- 环境变量管理
- 版本控制最佳实践
- 测试覆盖率

### 警惕过度优化

- 如果一个简单的错误需要完全重构 → 有些不对劲
- 尝试其他模型（Gemini、不同的Claude）——也许有更简单的解决方案
- 不要让AI过度设计简单的问题
- 在完美代码和实际交付之间取得平衡

---

## 先决条件和下一步

**需要完成：**
- [阶段2：开发](./phase-2-development-zh.md) — 所有功能已实施并提交
- [核心技术设置](../core-technologies-zh.md) — Astro + Tailwind + Cloudflare堆栈已配置
- [开发工具](../development-tools/README-zh.md) — DevTools MCP和测试工具已配置

**准备用于：**
- [阶段4：部署](./phase-4-deployment-zh.md) — 生产部署和CI/CD设置
- [托管工具](../hosting-tools/README-zh.md) — Cloudflare基础设施配置
- [商业策略](../introduction/README-zh.md) — 客户交付和维护

**相关阅读：**
- [上下文管理](../context-management/README-zh.md) — 调试上下文和错误跟踪
- [AI模型提供商](../ai-model-providers/README-zh.md) — 调试任务的优化
- [开发工具：DevTools MCP](../development-tools/mcp-servers/devtools-mcp-zh.md) — 高级测试能力

**测试集成：**
- 通过[DevTools MCP](../development-tools/mcp-servers/devtools-mcp-zh.md)进行自动化测试以进行全面调试
- 遵循[阶段2实践](./phase-2-development-zh.md#手动测试)的手动测试
- 使用[AI模型提供商](../ai-model-providers/README-zh.md)进行代码审查以进行质量分析

---

## 调试故障排除

**测试期间的常见调试挑战和解决方案**

### AI找不到错误

**症状**：尽管提供了错误消息和代码，AI无法识别根本原因。

**根本原因：**
1. 诊断信息不足
2. 错误是环境性的（不在代码本身中）
3. 组件之间的复杂交互
4. 时间/异步问题

**解决方案：**

**解决方案1：提供完整的诊断数据**
```
"帮助调试此问题：

错误消息：
[完整错误文本，不截断]

堆栈跟踪：
[包含所有帧的完整堆栈跟踪]

浏览器控制台：
[所有控制台消息、警告、错误]

网络标签：
- 请求URL：[URL]
- 状态：[状态代码]
- 响应：[响应体]
- 头：[相关头]

错误位置的代码（[文件:行]）：
[错误周围的10-20行]

触发它的用户操作：
[重现的确切步骤]

环境：
- 浏览器：[Chrome 120 / Firefox 115]
- 操作系统：[macOS / Windows / Linux]
- Node版本：[18.16.0]
- 框架版本：[React 18.2.0]"
```

**解决方案2：创建最小复现**
```
"我已经将错误隔离到最小复现：

[演示问题的最小代码]

仅此代码就会触发错误。
不需要其他依赖项或组件。

预期：[行为]
实际：[行为]

调试这个最小用例。"
```

**解决方案3：使用DevTools MCP**
```
"使用DevTools MCP调试此问题：
1. 导航到http://localhost:3000/problem-page
2. 打开DevTools并监控：
   - 控制台错误
   - 网络请求和响应
   - 元素的DOM问题
3. 通过[步骤]重现错误
4. 分析发生的事情并识别根本原因"
```

**预防：**
- 始终提供完整的错误信息（不要截断）
- 包括堆栈跟踪
- 描述重现步骤
- 检查浏览器兼容性

**相关**：[无法调试问题流程图](../troubleshooting/README-zh.md#流程图2无法调试问题)

---

### 更改后测试失败

**症状**：以前通过的测试现在失败。

**快速诊断：**
```bash
# 运行测试以查看失败
npm test

# 运行特定的失败测试
npm test -- UserService.test.ts

# 检查git diff
git diff HEAD~1 HEAD

# 识别更改的内容
git log --oneline -5
```

**快速修复：**
```
"最近的更改后测试失败：

失败的测试：
[测试名称和描述]

错误消息：
[测试错误输出]

最近的更改（git diff）：
[相关代码更改]

预期行为：[测试期望什么]
实际行为：[发生了什么]

修复选项：
1. 更新实现以匹配测试
2. 更新测试以匹配新实现（如果要求已更改）

请分析并修复。"
```

**根本原因分析：**
```
"测试失败分析：

失败的测试：
[测试名称]

错误：
[错误消息]

代码更改：
[相关代码片段]

为什么失败：
1. [原因1]
2. [原因2]

如何修复：
[修复方法]"
```

**预防：**
- 在提交之前运行测试
- 使用git hooks自动运行测试
- 编写健壮的测试（不脆弱）
- 更新测试时更新文档

---

### 性能回归

**症状**：新代码使网站变慢。

**诊断：**
```bash
# 运行Lighthouse
npm run lighthouse

# 检查包大小
npm run build -- --analyze

# 分析网络瀑布
# DevTools → Performance标签
```

**修复：**
```
"性能回归检测：

之前：
- Lighthouse性能：95
- 加载时间：1.5秒
- 包大小：200KB

之后：
- Lighthouse性能：75
- 加载时间：3.2秒
- 包大小：450KB

最近的更改：
[相关代码]

分析原因并优化。"
```

**常见原因：**
- 未优化的图像
- 未压缩的JavaScript/CSS
- 不必要的依赖项
- 低效的算法
- 缺少缓存

**预防：**
- 在部署之前运行Lighthouse
- 监控包大小
- 使用性能预算
- 实施代码分割

---

## 下一步

一旦测试和调试完成：

1. ✅ 所有功能都经过测试和工作
2. ✅ 性能优化
3. ✅ 代码经过审查和重构
4. ✅ 移动和桌面都经过测试
5. ✅ 质量标准满足
6. → **下一步**：[部署到生产](./phase-4-deployment-zh.md)

**相关阅读：**
- [故障排除指南](../troubleshooting/README-zh.md) - 调试策略和恢复模式
- [质量标准](../quality-standards/README-zh.md) - 可访问性、SEO和性能要求
- [提示：调试](../prompting/task-specific-patterns-zh.md#调试提示) - 有效的调试提示

---

**下一步**：[阶段4 → 部署](./phase-4-deployment-zh.md)

**返回**：[工作流程概述](./README-zh.md)