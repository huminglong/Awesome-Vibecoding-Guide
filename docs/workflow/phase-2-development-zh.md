# 阶段2：开发 🧩

**工具**：您首选的IDE/CLI + 编码代理 + MCP服务器

**基本技能**：有效的AI沟通在这个阶段至关重要。请参阅[掌握AI提示](../prompting/README-zh.md)了解任务特定模式、调试技术和即用型模板。

---

## 先决条件：环境设置

在开始开发之前，设置您的编码环境。这是规划（阶段1）和实际实施之间的桥梁。

### 1. 选择您的开发环境

选择符合您工作流程偏好的设置：

#### 选项A：基于IDE的开发

**Zed**（快速和极简主义 - 我的选择）
- 闪电般的性能
- 原生AI集成
- 非常适合经验丰富的开发人员
- 需要最少的配置

**VS Code + 扩展**
- 最灵活和可定制
- 广泛的扩展生态系统
- 与Claude Code扩展一起使用
- 如果您已经熟悉VS Code，则完美

#### 选项B：基于CLI的开发

**Claude Code CLI**（主要 - 我的选择）
- 官方Anthropic CLI工具
- 改进的计划模式，具有全局持久性
- 用于复杂任务的多代理架构
- 用于高效代码库导航的探索子代理
- 基于终端的工作流程，非常适合自动化
- 与您首选的文本编辑器一起工作

**Droid CLI**（次要 - 用于规范驱动的项目）
- 具有阶段的规范驱动开发
- 内置`/review`命令用于代码审查
- 最适合具有正式规范的大型项目
- 适合团队协调工作流程

### 2. 设置MCP服务器

MCP（模型上下文协议）服务器扩展您的编码代理的能力。

**基本MCP服务器：**

**Context7 MCP** - 您选择的技术栈文档和理解
- [设置指南](../development-tools/mcp-servers-zh.md)

**DevTools MCP** - 浏览器自动化
- 在真实浏览器中自动测试
- 自动调试前端问题
- Web开发必不可少
- 与Chrome集成

**Task Manager MCP** - 轻松管理任务和项目
- 组织任务和项目
- 优先考虑任务
- 跟踪进度

**Sequential Thinking MCP** - 在编码之前管理知识和计划
- 组织思想和想法
- 优先考虑任务
- 开发正确的东西，而不过度设计其余部分
- 跟踪思维过程并将其保存，而不是仅依赖代理的记忆

**ShadCN MCP** - UI组件库
- 使用预构建组件增强您的UI
- 节省时间和精力
- 与您首选的框架集成

### 3. 配置您的编码代理

为您首选的AI模型设置开发：

**GLM**（非常适合实施 - 我的一般选择）
- 快速且具有成本效益（与其他相比超级具有成本效益）
- 强大的编码能力
- 适合快速原型设计
- 处理大多数开发任务

### 4. 验证您的设置

在开始开发之前，确保：
- ✅ IDE/CLI已安装和配置
- ✅ 编码代理已连接和工作
- ✅ 基本MCP服务器正在运行
- ✅ 您可以访问项目文档
- ✅ Git已配置用于提交

---

## 开发工作流程

一旦您的环境准备就绪，请遵循这种系统方法：

### 1. 加载项目上下文

在您的开发环境中打开项目。

将相关功能规范加载到上下文中：
```bash
# 读取功能规范和任务
"将 feature-1-spec.md 和 feature-1-tasks.md 加载到上下文中"
```

### 2. 逐个功能实现

一次只处理**一个功能**，以保持专注并高效管理上下文。

**对于每个功能：**

**a. 查看任务**
```
"显示身份验证功能的所有任务"
```

**b. 逐个任务实现**
```
"实现任务1：在数据库中设置用户模式"
```

**c. 每个任务后手动审查**
- 检查生成的代码
- 测试功能
- 验证是否符合规范
- 如有需要，进行调整

**d. 功能完成后全面审查**
- 一起测试所有功能组件
- 检查与现有代码的集成
- 验证所有验收标准是否满足
- 如果有可用测试，运行自动化测试

**e. 提交完成的功能**
```bash
git add .
git commit -m "feat: 实现用户身份验证"
```

### 3. 上下文管理

保持上下文清洁和相关。请参阅[上下文管理指南](../context-management/README-zh.md)了解全面策略。

**要做：**
- ✅ 只加载当前功能规范
- ✅ 根据需要引用相关代码文件
- ✅ 切换功能时清除旧上下文
- ✅ 使用MCP服务器进行代码库查询

**不要：**
- ❌ 一次加载所有规范
- ❌ 在上下文中保留已完成的功能
- ❌ 在一个会话中混合多个功能
- ❌ 忽略上下文大小限制

---

## 开发规则

**一次一个功能**
- 不要在同一会话中混合功能
- 完成一个功能后再开始另一个
- 保持上下文可管理
- 更容易调试和审查

**模块化代码**
- 编写自包含的组件
- 模块间接口清晰
- 更容易理解和修改
- 更好的上下文管理

**频繁提交**
- 每个完成任务后提交（可选）
- 完成功能后总是提交
- 编写清晰的提交信息
- 如需回滚更容易

**手动审查**
- 没有审查绝不合并
- AI可能会犯错误
- 验证逻辑和边缘情况
- 提交前测试

---

## 开发会话示例

### 会话1：用户身份验证功能

**设置**
```bash
"加载功能：用户身份验证
读取：feature-1-spec.md, feature-1-tasks.md"
```

**任务1：数据库模式**
```bash
"实现任务1：创建包含电子邮件、密码哈希和时间戳的用户模式"
# 审查代码
# 测试模式
git add .
git commit -m "feat(auth): 添加用户数据库模式"
```

**任务2：注册端点**
```bash
"实现任务2：创建带有验证的 POST /api/register 端点"
# 审查实现
# 手动测试端点
git add .
git commit -m "feat(auth): 添加用户注册端点"
```

**任务3：登录端点**
```bash
"实现任务3：创建带有JWT生成的 POST /api/login 端点"
# 审查代码
# 测试登录流程
git add .
git commit -m "feat(auth): 添加带有JWT的登录端点"
```

**任务4：身份验证中间件**
```bash
"实现任务4：为受保护路由创建JWT验证中间件"
# 审查中间件
# 测试受保护路由
git add .
git commit -m "feat(auth): 添加JWT身份验证中间件"
```

**功能审查**
```bash
# 测试整个身份验证流程
# 验证所有验收标准
# 检查与应用程序的集成
git checkout -b feature/user-auth
# 审查后合并到main
```

### 会话2：仪表板UI功能

使用新功能上下文重新开始...

---

## 开发故障排除

**功能实现过程中的常见问题及其解决方案**

### AI生成的代码与规范不匹配

**症状：**
- 实现了错误的功能
- 缺少必需的功能
- 行为与预期不同

**快速修复：**
```
"代码与规范不匹配。具体来说：

规范说：[规范中的确切要求]
您的代码做：[实际实现的内容]

预期行为：[详细描述]
实际行为：[实际发生的情况]

请更新以完全匹配规范。"
```

**预防：**
- 明确引用规范文件："根据 docs/plans/feature-x.md，实现..."
- 在规范中包含示例
- 清楚定义成功标准
- 在继续之前对照规范审查代码

**相关：** [AI误解要求](../troubleshooting/README-zh.md#ai-misunderstands-requirements)

---

### 代码质量问题

#### 缺少错误处理

**症状：** 代码在正常路径下工作，但在错误时崩溃。

**快速修复：**
```
"添加全面的错误处理：

```typescript
// 当前代码
const user = await db.users.findById(id);
return user.name; // 如果用户为null则崩溃
```

添加错误处理：
- 检查用户是否存在（如果不存在则返回404）
- 数据库调用周围使用try-catch
- 用户友好的错误消息
- 记录错误以便调试

遵循 src/api/posts.ts 中的错误模式"
```

**预防：**
- 在初始提示中始终指定错误处理
- 使用[错误处理模板](../prompting/template-library-zh.md#template-16-security-fix)
- 引用现有错误模式

---

#### 缺少输入验证

**症状：** 没有对用户输入进行验证，存在潜在安全问题。

**快速修复：**
```
"添加输入验证：

必需验证：
- 电子邮件：有效格式，最多255个字符
- 密码：最少8个字符，复杂度要求
- 年龄：数字，18-120范围

使用[您的验证库]进行验证。
对于无效输入，返回400并附带字段特定错误。"
```

**预防：**
- 在初始提示中指定验证
- 使用验证库（Zod、Joi、express-validator）
- 创建验证模板

**相关：** [缺少输入验证](../troubleshooting/README-zh.md#missing-input-validation)

---

#### 安全漏洞

**症状：** 代码审查发现SQL注入、XSS或其他漏洞。

**快速修复：**
```
"对此代码进行安全审计：

[粘贴代码]

修复：
- SQL注入：使用参数化查询
- XSS：在渲染前清理用户输入
- 身份验证：在受保护路由上验证JWT
- 授权：检查用户权限
- 密钥：移至环境变量

遵循 src/api/auth.ts 中的安全模式"
```

**预防：**
- 在每个提示中提及安全性
- 使用[安全模板](../prompting/template-library-zh.md#security-templates)
- 定期安全审计
- 遵循OWASP指南

**相关：** [不安全代码生成](../troubleshooting/README-zh.md#insecure-code-generation)

---

### 集成问题

#### 新代码破坏现有功能

**症状：**
- 以前通过的测试现在失败
- 工作的功能现在被破坏
- 意外的副作用

**快速诊断：**
```bash
# 运行测试以识别破坏
npm test

# 检查git diff以查看更改内容
git diff main...feature-branch

# 识别集成点
grep -r "functionThatChanged" src/
```

**快速修复：**
```
"新的[功能]破坏了[现有功能]。

破坏内容：
- [失败的特定测试/功能]
- 错误：[错误消息]

集成点：
- [新代码]调用[现有代码]
- [现有代码]期望[接口]但得到[不同接口]

修复要求：
- 保持向后兼容性
- 如需要更新[现有代码]
- 确保所有测试通过
- 对公共API无破坏性更改"
```

**预防：**
- 始终指定："不要破坏现有功能"
- 每次更改后运行测试
- 编写集成测试
- 仔细审查更改

**相关：** [破坏性更改流程图](../troubleshooting/README-zh.md#flowchart-4-breaking-changes)

---

#### API契约不匹配

**症状：** 前端期望的响应格式与后端提供的不符。

**快速修复：**
```
"API契约不匹配：

前端期望：
{ data: { id, name, email }, success: true }

后端返回：
{ id, name, email }

更新后端以匹配前端契约或更新前端以处理后端格式。

首选：更新后端（减少干扰）。
确保所有端点的API响应格式一致。"
```

**预防：**
- 预先定义API契约（docs/api/endpoints.md）
- 在FE/BE之间共享TypeScript接口
- 从OpenAPI规范生成类型
- API契约的集成测试

---

### 开发过程中的上下文管理失败

#### AI失去架构跟踪

**症状：** AI建议违反项目架构或模式的解决方案。

**快速修复：**
```
"您建议了[解决方案]，但我们的架构使用[不同方法]。

我们的架构（来自 docs/architecture/overview.md）：
- [关键原则1]
- [关键原则2]

请修改解决方案以匹配我们的架构。
具体来说：[需要更改的内容]"
```

**预防：**
- 在会话开始时引用架构文档
- 创建带有架构说明的.cursorrules
- 当AI偏离时提醒AI架构
- 保持架构文档更新

**相关：** [上下文感知提示](../prompting/advanced-techniques-zh.md#context-aware-prompting)

---

#### 忘记编码标准

**症状：** 代码风格与项目不一致（制表符与空格、命名、模式）。

**快速修复：**
```
"代码风格与项目标准不匹配。

您的代码使用：
- 文件名使用camelCase（我们使用kebab-case）
- 类组件（我们只使用函数式）
- .then()链（我们使用async/await）

请按照.cursorrules中的标准重写"
```

**预防：**
- 创建包含所有约定的.cursorrules
- 在提示中引用样式指南
- 使用代码格式化程序（Prettier）
- 定期样式检查

**相关：** [代码风格问题](../troubleshooting/README-zh.md#code-style-doesnt-match-project)

---

### 提示质量问题

#### 迭代次数过多

**症状：** 需要5-10次尝试才能获得工作代码。

**根本原因：**
- 初始提示模糊
- 缺少示例
- 没有成功标准

**快速修复：**
应用4组件框架：

```
[清晰度]：实现用户配置文件更新端点

[上下文]：
- 模式：遵循 src/api/users.ts 中的 POST /users 模式
- 验证：使用 src/middleware/validation.ts 中的 ValidationMiddleware
- 模式：src/models/User.ts 中的用户模型

[约束]：
- 用户只能更新自己的配置文件（或管理员可以更新任何配置文件）
- 可更新字段：姓名、电子邮件、简介（不是密码、角色）
- 电子邮件必须保持唯一
- 最大简介长度：500个字符

[标准]：
- PUT /api/users/:id 返回更新的用户（200）
- 如果用户尝试更新另一个用户的配置文件，返回403
- 如果电子邮件已存在，返回409
- 对于验证错误，返回400
- 测试通过
```

**预防：**
- 学习[提示基础](../prompting/foundations-zh.md)
- 使用[提示模板](../prompting/template-library-zh.md)
- 始终包含示例
- 定义成功标准

---

#### AI忽略要求

**症状：** 生成的代码缺少指定功能或违反约束。

**快速修复：**
```
"您的代码缺少这些要求：

需要但缺少：
1. [要求1] - 未实现
2. [要求2] - 未实现

请添加缺少的要求。我将验证：
- [检查1]
- [检查2]
然后接受代码。"
```

**预防：**
- 对要求使用编号列表（更难错过）
- 为关键项目添加"MUST"或"REQUIRED"
- 请求AI在实现前确认理解
- 使用自检查提示

**相关：** [AI忽略约束](../troubleshooting/README-zh.md#ai-ignores-constraints)

---

## 开发阶段调试清单

当开发过程中出现问题时：

### 在向AI寻求帮助之前

- [ ] 完整阅读错误消息
- [ ] 检查堆栈跟踪中的文件:行
- [ ] 验证所有必需文件存在
- [ ] 检查变量/函数名中的拼写错误
- [ ] 确保依赖项已安装（npm install）
- [ ] 尝试最简单的可能重现

### 为AI收集上下文

- [ ] 错误消息（全文）
- [ ] 堆栈跟踪（相关行）
- [ ] 错误位置的代码（带上下文）
- [ ] 您试图做什么
- [ ] 您已经尝试过什么
- [ ] 如果可能，最小重现

### 调试提示

使用此模板：

```
"调试此错误：

错误消息：
[确切错误文本]

堆栈跟踪：
[带文件:行的相关行]

代码（[文件]）：
[错误周围的代码片段]

上下文：
- 正在执行：[触发错误的操作]
- 环境：[开发/生产]
- 开始时间：[最近更改]

预期：[应该发生什么]
实际：[实际发生什么]

已尝试：
- [尝试1] → [结果]
- [尝试2] → [结果]"
```

---

## 有效开发技巧

✅ **在功能之间休息** - 清醒的头脑能发现更多问题

✅ **使用描述性提交消息** - 未来的您会感谢您

✅ **增量测试** - 不要等到一切都"完成"

✅ **利用MCP服务器** - 让AI探索代码库结构

✅ **请求替代方案** - 如果卡住，请求不同的方法

✅ **保持任务小** - 更容易实现和审查

✅ **随行记录** - 为复杂逻辑添加注释

---

## 要避免的常见陷阱

❌ **没有环境设置就开始** - 在开发过程中浪费时间

❌ **混合多个功能** - 创建上下文混乱和错误

❌ **跳过手动审查** - AI可能会错过边缘情况

❌ **大提交** - 难以审查和调试

❌ **忽略MCP能力** - 使上下文管理更困难

❌ **不增量测试** - 问题复合并变得难以修复

---

## 先决条件和下一步

**需要完成：**
- [阶段1：规划](./phase-1-planning-zh.md) — 功能规范和项目结构
- [核心技术设置](../core-technologies-zh.md) — Astro + Tailwind + Cloudflare技术栈
- [工具准备](./phase-0-vibecoder-preparation-zh.md) — 开发环境和编码代理

**为以下做准备：**
- [阶段3：测试和调试](./phase-3-testing-debugging-zh.md) — 全面测试和质量保证
- [阶段4：部署](./phase-4-deployment-zh.md) — 生产部署和CI/CD
- [业务策略](../introduction/README-zh.md) — 客户交付和维护工作流程

**相关阅读：**
- [开发工具](../development-tools/README-zh.md) — 详细的工具配置和使用
- [AI模型提供商](../ai-model-providers/README-zh.md) — 针对不同开发任务的优化
- [上下文管理](../context-management/README-zh.md) — 开发过程中的高效上下文处理

## 下一步

一旦您实现了您的功能：

1. ✅ 所有功能已实现
2. ✅ 代码已提交到版本控制
3. ✅ 手动测试显示核心功能工作
4. ✅ 遵循上下文管理实践
5. → **下一步**：[全面测试和调试](./phase-3-testing-debugging-zh.md)

---

下一步：[阶段3 → 测试和调试](./phase-3-testing-debugging-zh.md)

返回：[工作流程概述](./README-zh.md)